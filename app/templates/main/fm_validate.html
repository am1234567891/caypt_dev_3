{% extends "main/main_base.html" %}  {# main/main_base.html extends app_main_layout.html #}

{% block page_title %}
    Tournament Admin Management - Final Match
    {% if current_room_code > 0 %}
         - Room {{ master_mrooms[current_room_code-1][1] }}
    {% endif %}
    <div class="dropdown" style="float: right">
        <button class="btn btn-info dropdown-toggle" type="button" data-toggle="dropdown">Action
        <span class="caret"></span></button>
        <ul class="dropdown-menu">
          <li><a href="/admin_view_regist?type=team">Team Registration</a></li>
          <li><a href="/admin_view_regist?type=student">Student Registration</a></li>
          <li><a href="/admin_view_regist?type=juror">Juror Registration</a></li>
          <li><a href="/admin_view_regist?type=volunteer">Volunteer Registration</a></li>
        </ul>
    </div>
{% endblock %}

{% from "flask_user/_macros.html" import render_field, render_submit_field %}

{% block body %}
    {{ super() }}

    <div class="container mt-3">

        <div class="alert alert-danger">
          <strong>Danger!</strong> Publish is very powerful and only for the Tournament days.
            <BR><strong>You must UN-Publish immediately at the end of the tournament day.</strong>
            . If you have any questions, please contact the information team ASAP.
        </div>
        <ul class="nav nav-tabs">
            <li><a href="/admin_mgmt">View Plan</a></li>
            <li><a href="/publish">Publish</a></li>
            <li class="active"><a href="#">FM Validation</a></li>
        </ul>
        <br>
    </div>
    <form class="form-inline" action="" method="POST">
        {{ form.hidden_tag() }}
        <input type="hidden" name="plan_sub_status" value="{{plan_sub_status}}">
        <input type="hidden" name="fm_plan_id" value="{{fm_plan_id}}">
        <input type="hidden" name="sm_plan_id" value="{{sm_plan_id}}">
        <input type="hidden" name="current_mpair_id" value="{{current_mpair_id}}">
        <div class = "container">
            <h3>Validate Scores</h3>
            <h4>
                Grades
                {% for team_score in ranked_team_codes_SP %}
                    <input type="hidden" name="ds_f{{loop.index}}_mteam_code" value="{{current_team_codes[team_score['original_team_sequence']-1]}}">
                    <input type="hidden" name="ds_f{{loop.index}}_mteam_code_SP" value="{{current_team_codes_SP[team_score['original_team_sequence']-1]}}">
                    <input type="hidden" name="ds_f{{loop.index}}_mteam_code_fw" value="{{team_score['fw']}}">
                    <span class="label label-info lb-md">
                        {{master_mteams[current_team_codes[team_score['original_team_sequence']-1] -1][1]}}: {{current_team_codes_SP[team_score['original_team_sequence']-1]}}
                        {% if team_score['ranking'] == 1 %}
                            <font color="gold" size="3">â˜…</font>
                        {% endif %}
                    </span>
                {% endfor %}
            </h4><BR>
            <div class="row"></div>
            <!-- stage 1 -->
            <div class="row">
                <div class="col-lg-4">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th></th>
                                <th>
                                    Reporter: {{master_mteams[sm_current_pair_scores[0][2][0][1]-1][1]}}
                                </th>
                                <th>
                                    Opponent: {{master_mteams[sm_current_pair_scores[0][2][1][1]-1][1]}}
                                </th>
                                <th>
                                    Reviewer: {{master_mteams[sm_current_pair_scores[0][2][2][1]-1][1]}}
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td></td>
                                <td>{{sm_current_pair_scores[0][2][0][4][1]}}</td>
                                <td>{{sm_current_pair_scores[0][2][1][4][1]}}</td>
                                <td>{{sm_current_pair_scores[0][2][2][4][1]}}</td>
                            </tr>
                            <tr>
                                <td>
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>Juror</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for row in sm_current_pair_scores[0][2][0][3] %}
                                                <tr><td> {{master_mjurors[row[1]-1][1]}} <BR><BR></td></tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </td>
                                <td> <!-- stage 1:Reporter Scores table -->
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>Scores</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for row in sm_current_pair_scores[0][2][0][3] %}
                                                <tr>
                                                    <td>
                                                        {% if row[0] == current_dstage_score_id %}
                                                            <!-- for edit data ds_sc_1 to ds_sc_7 (request.GET to enable edit, request.post to save updates) -->
                                                            <input type="hidden" name="ds_sc_id" value="{{current_dstage_score_id}}">
                                                            <input type="hidden" name="ds_sc_5" value="0">
                                                            <input type="hidden" name="ds_sc_6" value="0">
                                                            <input type="hidden" name="ds_sc_7" value="0">
                                                            <div class="form-group" id="ds_sc">
                                                                <input type="number" step="0.1" placeholder="0.0" required max="1" min="0" title="0 ~ 1" readonly
                                                                       class="form-control" id="ds_sc_1" name="ds_sc_1" size="1" value="{{row[3]}}">+
                                                                <input type="number" step="0.1" placeholder="0.0" required max="7" min="0" title="0 ~ 7"
                                                                       class="form-control" id="ds_sc_2" name="ds_sc_2" size="1" value="{{row[4]}}">+
                                                                <input type="number" step="0.1" placeholder="0.0" required max="3" min="0" title="0 ~ 3"
                                                                       class="form-control" id="ds_sc_3" name="ds_sc_3" size="1" value="{{row[5]}}">+
                                                                <input type="number" step="0.1" placeholder="-0.0" required max="0" min="-2" title="-2 ~ 0"
                                                                       class="form-control" id="ds_sc_4" name="ds_sc_4" size="1" value="{{row[6]}}">
                                                                <button type="button" class="btn btn-default btn-sm" onclick="checkTotal('ds_sc', 'ds_sc_total')">=</button>
                                                                <button type="button" class="btn btn-warning btn-sm" id="ds_sc_total">{{row[2]}}</button>
                                                            </div>
                                                            <button class="btn btn-info btn-sm pull-right" type="submit" value="update">Update</button>
                                                        {% else %}
                                                            <!-- display scores for each cell-->
                                                            <strong>
                                                                <a href="/fm_validate?sm_plan_id={{sm_plan_id}}&fm_plan_id={{fm_plan_id}}&plan_sub_status={{plan_sub_status}}&dss={{row[0]}}">
                                                                    {{row[2]}}
                                                                </a> =
                                                            </strong>
                                                            {{row[3]}} + {{row[4]}} + {{row[5]}}
                                                            {% if row[6] >= 0 %}
                                                                + {{row[6]}}
                                                            {% else %}
                                                                - {{0-row[6]}}
                                                            {% endif %}
                                                            <BR><BR>
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </td>
                                <td> <!-- stage 1:Opponent Scores table -->
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>Scores</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for row in sm_current_pair_scores[0][2][1][3] %}
                                                <tr>
                                                    <td>
                                                        {% if row[0] == current_dstage_score_id %}
                                                            <input type="hidden" name="ds_sc_id" value="{{current_dstage_score_id}}">
                                                            <input type="hidden" name="ds_sc_6" value="0">
                                                            <input type="hidden" name="ds_sc_7" value="0">
                                                            <div class="form-group" id="ds_sc">
                                                                <input type="number" step="0.1" placeholder="0.0" required max="1" min="0" title="0 ~ 1" readonly
                                                                       class="form-control" id="ds_sc_1" name="ds_sc_1" size="2" value="{{row[3]}}">+
                                                                <input type="number" step="0.1" placeholder="0.0" required max="2" min="0" title="0 ~ 2"
                                                                       class="form-control" id="ds_sc_2" name="ds_sc_2" size="2" value="{{row[4]}}">+
                                                                <input type="number" step="0.1" placeholder="0.0" required max="4" min="0" title="0 ~ 4"
                                                                       class="form-control" id="ds_sc_3" name="ds_sc_3" size="2" value="{{row[5]}}">+
                                                                <input type="number" step="0.1" placeholder="0.0" required max="4" min="0" title="0 ~ 4"
                                                                       class="form-control" id="ds_sc_4" name="ds_sc_4" size="2" value="{{row[6]}}">+
                                                                <input type="number" step="0.1" placeholder="-0.0" required max="0" min="-2" title="-2 ~ 0"
                                                                       class="form-control" id="ds_sc_5" name="ds_sc_5" size="2" value="{{row[7]}}">
                                                                <button type="button" class="btn btn-default btn-sm" onclick="checkTotal('ds_sc', 'ds_sc_total')">=</button>
                                                                <button type="button" class="btn btn-warning btn-sm" id="ds_sc_total">{{row[2]}}</button>
                                                            </div>
                                                            <button class="btn btn-info btn-sm pull-right" type="submit" value="update">Update</button>
                                                        {% else %}
                                                            <strong>
                                                                <a href="/fm_validate?sm_plan_id={{sm_plan_id}}&fm_plan_id={{fm_plan_id}}&plan_sub_status={{plan_sub_status}}&dss={{row[0]}}">
                                                                    {{row[2]}}
                                                                </a> =
                                                            </strong>
                                                            {{row[3]}} + {{row[4]}} + {{row[5]}} + {{row[6]}}
                                                            {% if row[7] >= 0 %}
                                                                + {{row[7]}}
                                                            {% else %}
                                                                - {{0-row[7]}}
                                                            {% endif %}
                                                            <BR><BR>
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </td>
                                <td> <!-- stage 1:Reviewer Scores table -->
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>Scores</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for row in sm_current_pair_scores[0][2][2][3] %}
                                                <tr>
                                                    <td>
                                                        {% if row[0] == current_dstage_score_id %}
                                                            <input type="hidden" name="ds_sc_id" value="{{current_dstage_score_id}}">
                                                            <div class="form-group" id="ds_sc">
                                                                <input type="number" step="0.1" placeholder="0.0" required max="1" min="0" title="0 ~ 1" readonly
                                                                       class="form-control" id="ds_sc_1" name="ds_sc_1" size="1" value="{{row[3]}}">+
                                                                <input type="number" step="0.1" placeholder="0.0" required max="2" min="0" title="0 ~ 2"
                                                                       class="form-control" id="ds_sc_2" name="ds_sc_2" size="1" value="{{row[4]}}">+
                                                                <input type="number" step="0.1" placeholder="0.0" required max="3" min="0" title="0 ~ 3"
                                                                       class="form-control" id="ds_sc_3" name="ds_sc_3" size="1" value="{{row[5]}}">+
                                                                <input type="number" step="0.1" placeholder="0.0" required max="3" min="0" title="0 ~ 3"
                                                                       class="form-control" id="ds_sc_4" name="ds_sc_4" size="1" value="{{row[6]}}">+
                                                                <input type="number" step="0.1" placeholder="0.0" required max="2" min="0" title="0 ~ 2"
                                                                       class="form-control" id="ds_sc_5" name="ds_sc_5" size="1" value="{{row[7]}}">+
                                                                <input type="number" step="0.1" placeholder="0.0" required max="1" min="-1" title="-1 ~ 1"
                                                                       class="form-control" id="ds_sc_6" name="ds_sc_6" size="1" value="{{row[8]}}">+
                                                                <input type="number" step="0.1" placeholder="0.0" required max="0" min="-2" title="-2 ~ 0"
                                                                       class="form-control" id="ds_sc_7" name="ds_sc_7" size="1" value="{{row[9]}}">
                                                                <button type="button" class="btn btn-default btn-sm" onclick="checkTotal('ds_sc', 'ds_sc_total')">=</button>
                                                                <button type="button" class="btn btn-warning btn-sm" id="ds_sc_total">{{row[2]}}</button>
                                                            </div>
                                                            <button class="btn btn-info btn-sm pull-right" type="submit" value="update">Update</button>
                                                        {% else %}
                                                            <strong>
                                                                <a href="/fm_validate?sm_plan_id={{sm_plan_id}}&fm_plan_id={{fm_plan_id}}&plan_sub_status={{plan_sub_status}}&dss={{row[0]}}">
                                                                    {{row[2]}}
                                                                </a> =
                                                            </strong>
                                                            {{row[3]}} + {{row[4]}} + {{row[5]}} + {{row[6]}} + {{row[7]}}
                                                            {% if row[8] >= 0 %}
                                                                + {{row[8]}}
                                                            {% else %}
                                                                - {{0-row[8]}}
                                                            {% endif %}
                                                            {% if row[9] >= 0 %}
                                                                + {{row[9]}}
                                                            {% else %}
                                                                - {{0-row[9]}}
                                                            {% endif %}
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- stage 2 -->
                <div class="col-lg-4">
                    <table class="table table-bordered">
                        <thead>
                            <tr bgcolor="lightblue">
                                <th>
                                    Reporter: {{master_mteams[sm_current_pair_scores[1][2][0][1]-1][1]}}
                                </th>
                                <th>
                                    Opponent: {{master_mteams[sm_current_pair_scores[1][2][1][1]-1][1]}}
                                </th>
                                <th>
                                    Reviewer: {{master_mteams[sm_current_pair_scores[1][2][2][1]-1][1]}}
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>{{sm_current_pair_scores[1][2][0][4][1]}}</td>
                                <td>{{sm_current_pair_scores[1][2][1][4][1]}}</td>
                                <td>{{sm_current_pair_scores[1][2][2][4][1]}}</td>
                            </tr>
                            <tr>
                                <td> <!-- stage 2:Reporter Scores table -->
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>Scores</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for row in sm_current_pair_scores[1][2][0][3] %}
                                                <tr>
                                                    <td>
                                                        {% if row[0] == current_dstage_score_id %}
                                                            <input type="hidden" name="ds_sc_id" value="{{current_dstage_score_id}}">
                                                            <input type="hidden" name="ds_sc_5" value="0">
                                                            <input type="hidden" name="ds_sc_6" value="0">
                                                            <input type="hidden" name="ds_sc_7" value="0">
                                                            <div class="form-group" id="ds_sc">
                                                                <input type="number" step="0.1" placeholder="0.0" required max="1" min="0" title="0 ~ 1" readonly
                                                                       class="form-control" id="ds_sc_1" name="ds_sc_1" size="1" value="{{row[3]}}">+
                                                                <input type="number" step="0.1" placeholder="0.0" required max="7" min="0" title="0 ~ 7"
                                                                       class="form-control" id="ds_sc_2" name="ds_sc_2" size="1" value="{{row[4]}}">+
                                                                <input type="number" step="0.1" placeholder="0.0" required max="3" min="0" title="0 ~ 3"
                                                                       class="form-control" id="ds_sc_3" name="ds_sc_3" size="1" value="{{row[5]}}">+
                                                                <input type="number" step="0.1" placeholder="-0.0" required max="0" min="-2" title="-2 ~ 0"
                                                                       class="form-control" id="ds_sc_4" name="ds_sc_4" size="1" value="{{row[6]}}">
                                                                <button type="button" class="btn btn-default btn-sm" onclick="checkTotal('ds_sc', 'ds_sc_total')">=</button>
                                                                <button type="button" class="btn btn-warning btn-sm" id="ds_sc_total">{{row[2]}}</button>
                                                            </div>
                                                            <button class="btn btn-info btn-sm pull-right" type="submit" value="update">Update</button>
                                                        {% else %}
                                                            <strong>
                                                                <a href="/fm_validate?sm_plan_id={{sm_plan_id}}&fm_plan_id={{fm_plan_id}}&plan_sub_status={{plan_sub_status}}&dss={{row[0]}}">
                                                                    {{row[2]}}
                                                                </a> =
                                                            </strong>
                                                            {{row[3]}} + {{row[4]}} + {{row[5]}}
                                                            {% if row[6] >= 0 %}
                                                                + {{row[6]}}
                                                            {% else %}
                                                                - {{0-row[6]}}
                                                            {% endif %}
                                                            <BR><BR>
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </td>
                                <td> <!-- stage 2:Opponent Scores table -->
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>Scores</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for row in sm_current_pair_scores[1][2][1][3] %}
                                                <tr>
                                                    <td>
                                                        {% if row[0] == current_dstage_score_id %}
                                                            <input type="hidden" name="ds_sc_id" value="{{current_dstage_score_id}}">
                                                            <input type="hidden" name="ds_sc_6" value="0">
                                                            <input type="hidden" name="ds_sc_7" value="0">
                                                            <div class="form-group" id="ds_sc">
                                                                <input type="number" step="0.1" placeholder="0.0" required max="1" min="0" title="0 ~ 1" readonly
                                                                       class="form-control" id="ds_sc_1" name="ds_sc_1" size="2" value="{{row[3]}}">+
                                                                <input type="number" step="0.1" placeholder="0.0" required max="2" min="0" title="0 ~ 2"
                                                                       class="form-control" id="ds_sc_2" name="ds_sc_2" size="2" value="{{row[4]}}">+
                                                                <input type="number" step="0.1" placeholder="0.0" required max="4" min="0" title="0 ~ 4"
                                                                       class="form-control" id="ds_sc_3" name="ds_sc_3" size="2" value="{{row[5]}}">+
                                                                <input type="number" step="0.1" placeholder="0.0" required max="4" min="0" title="0 ~ 4"
                                                                       class="form-control" id="ds_sc_4" name="ds_sc_4" size="2" value="{{row[6]}}">+
                                                                <input type="number" step="0.1" placeholder="-0.0" required max="0" min="-2" title="-2 ~ 0"
                                                                       class="form-control" id="ds_sc_5" name="ds_sc_5" size="2" value="{{row[7]}}">
                                                                <button type="button" class="btn btn-default btn-sm" onclick="checkTotal('ds_sc', 'ds_sc_total')">=</button>
                                                                <button type="button" class="btn btn-warning btn-sm" id="ds_sc_total">{{row[2]}}</button>
                                                            </div>
                                                            <button class="btn btn-info btn-sm pull-right" type="submit" value="update">Update</button>
                                                        {% else %}
                                                            <strong>
                                                                <a href="/fm_validate?sm_plan_id={{sm_plan_id}}&fm_plan_id={{fm_plan_id}}&plan_sub_status={{plan_sub_status}}&dss={{row[0]}}">
                                                                    {{row[2]}}
                                                                </a> =
                                                            </strong>
                                                            {{row[3]}} + {{row[4]}} + {{row[5]}} + {{row[6]}}
                                                            {% if row[7] >= 0 %}
                                                                + {{row[7]}}
                                                            {% else %}
                                                                - {{0-row[7]}}
                                                            {% endif %}
                                                            <BR><BR>
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </td>
                                <td> <!-- stage 2:Reviewer Scores table -->
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>Scores</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for row in sm_current_pair_scores[1][2][2][3] %}
                                                <tr>
                                                    <td>
                                                        {% if row[0] == current_dstage_score_id %}
                                                            <input type="hidden" name="ds_sc_id" value="{{current_dstage_score_id}}">
                                                            <div class="form-group" id="ds_sc">
                                                                <input type="number" step="0.1" placeholder="0.0" required max="1" min="0" title="0 ~ 1" readonly
                                                                       class="form-control" id="ds_sc_1" name="ds_sc_1" size="1" value="{{row[3]}}">+
                                                                <input type="number" step="0.1" placeholder="0.0" required max="2" min="0" title="0 ~ 2"
                                                                       class="form-control" id="ds_sc_2" name="ds_sc_2" size="1" value="{{row[4]}}">+
                                                                <input type="number" step="0.1" placeholder="0.0" required max="3" min="0" title="0 ~ 3"
                                                                       class="form-control" id="ds_sc_3" name="ds_sc_3" size="1" value="{{row[5]}}">+
                                                                <input type="number" step="0.1" placeholder="0.0" required max="3" min="0" title="0 ~ 3"
                                                                       class="form-control" id="ds_sc_4" name="ds_sc_4" size="1" value="{{row[6]}}">
                                                                <input type="number" step="0.1" placeholder="0.0" required max="2" min="0" title="0 ~ 2"
                                                                       class="form-control" id="ds_sc_5" name="ds_sc_5" size="1" value="{{row[7]}}">
                                                                <input type="number" step="0.1" placeholder="0.0" required max="1" min="-1" title="-1 ~ 1"
                                                                       class="form-control" id="ds_sc_6" name="ds_sc_6" size="2" value="{{row[8]}}">
                                                                <input type="number" step="0.1" placeholder="0.0" required max="0" min="-2" title="-2 ~ 0"
                                                                       class="form-control" id="ds_sc_7" name="ds_sc_7" size="2" value="{{row[9]}}">
                                                                <button type="button" class="btn btn-default btn-sm" onclick="checkTotal('ds_sc', 'ds_sc_total')">=</button>
                                                                <button type="button" class="btn btn-warning btn-sm" id="ds_sc_total">{{row[2]}}</button>
                                                            </div>
                                                            <button class="btn btn-info btn-sm pull-right" type="submit" value="update">Update</button>
                                                        {% else %}
                                                            <strong>
                                                                <a href="/fm_validate?sm_plan_id={{sm_plan_id}}&fm_plan_id={{fm_plan_id}}&plan_sub_status={{plan_sub_status}}&dss={{row[0]}}">
                                                                    {{row[2]}}
                                                                </a> =
                                                            </strong>
                                                            {{row[3]}} + {{row[4]}} + {{row[5]}} + {{row[6]}} + {{row[7]}}
                                                            {% if row[8] >= 0 %}
                                                                + {{row[8]}}
                                                            {% else %}
                                                                - {{0-row[8]}}
                                                            {% endif %}
                                                            {% if row[9] >= 0 %}
                                                                + {{row[9]}}
                                                            {% else %}
                                                                - {{0-row[9]}}
                                                            {% endif %}
                                                            <BR><BR>
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- stage 3 -->
                <div class="col-lg-4">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>
                                    Reporter: {{master_mteams[sm_current_pair_scores[2][2][0][1]-1][1]}}
                                </th>
                                <th>
                                    Opponent: {{master_mteams[sm_current_pair_scores[2][2][1][1]-1][1]}}
                                </th>
                                <th>
                                    Reviewer: {{master_mteams[sm_current_pair_scores[2][2][2][1]-1][1]}}
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>{{sm_current_pair_scores[2][2][0][4][1]}}</td>
                                <td>{{sm_current_pair_scores[2][2][1][4][1]}}</td>
                                <td>{{sm_current_pair_scores[2][2][2][4][1]}}</td>
                            </tr>
                            <tr>
                                <td> <!-- stage 3:Reporter Scores table -->
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>Scores</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for row in sm_current_pair_scores[2][2][0][3] %}
                                                <tr>
                                                    <td>
                                                        {% if row[0] == current_dstage_score_id %}
                                                            <input type="hidden" name="ds_sc_id" value="{{current_dstage_score_id}}">
                                                            <input type="hidden" name="ds_sc_5" value="0">
                                                            <input type="hidden" name="ds_sc_6" value="0">
                                                            <input type="hidden" name="ds_sc_7" value="0">
                                                            <div class="form-group" id="ds_sc">
                                                                <input type="number" step="0.1" placeholder="0.0" required max="1" min="0" title="0 ~ 1" readonly
                                                                       class="form-control" id="ds_sc_1" name="ds_sc_1" size="1" value="{{row[3]}}">+
                                                                <input type="number" step="0.1" placeholder="0.0" required max="7" min="0" title="0 ~ 7"
                                                                       class="form-control" id="ds_sc_2" name="ds_sc_2" size="1" value="{{row[4]}}">+
                                                                <input type="number" step="0.1" placeholder="0.0" required max="3" min="0" title="0 ~ 3"
                                                                       class="form-control" id="ds_sc_3" name="ds_sc_3" size="1" value="{{row[5]}}">+
                                                                <input type="number" step="0.1" placeholder="-0.0" required max="0" min="-2" title="-2 ~ 0"
                                                                       class="form-control" id="ds_sc_4" name="ds_sc_4" size="1" value="{{row[6]}}">
                                                                <button type="button" class="btn btn-default btn-sm" onclick="checkTotal('ds_sc', 'ds_sc_total')">=</button>
                                                                <button type="button" class="btn btn-warning btn-sm" id="ds_sc_total">{{row[2]}}</button>
                                                            </div>
                                                            <button class="btn btn-info btn-sm pull-right" type="submit" value="update">Update</button>
                                                        {% else %}
                                                            <strong>
                                                                <a href="/fm_validate?sm_plan_id={{sm_plan_id}}&fm_plan_id={{fm_plan_id}}&plan_sub_status={{plan_sub_status}}&dss={{row[0]}}">
                                                                    {{row[2]}}
                                                                </a> =
                                                            </strong>
                                                            {{row[3]}} + {{row[4]}} + {{row[5]}}
                                                            {% if row[6] >= 0 %}
                                                                + {{row[6]}}
                                                            {% else %}
                                                                - {{0-row[6]}}
                                                            {% endif %}
                                                            <BR><BR>
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </td>
                                <td> <!-- stage 3:Opponent Scores table -->
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>Scores</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for row in sm_current_pair_scores[2][2][1][3] %}
                                                <tr>
                                                    <td>
                                                        {% if row[0] == current_dstage_score_id %}
                                                            <input type="hidden" name="ds_sc_id" value="{{current_dstage_score_id}}">
                                                            <input type="hidden" name="ds_sc_6" value="0">
                                                            <input type="hidden" name="ds_sc_7" value="0">
                                                            <div class="form-group" id="ds_sc">
                                                                <input type="number" step="0.1" placeholder="0.0" required max="1" min="0" title="0 ~ 1" readonly
                                                                       class="form-control" id="ds_sc_1" name="ds_sc_1" size="2" value="{{row[3]}}">+
                                                                <input type="number" step="0.1" placeholder="0.0" required max="2" min="0" title="0 ~ 2"
                                                                       class="form-control" id="ds_sc_2" name="ds_sc_2" size="2" value="{{row[4]}}">+
                                                                <input type="number" step="0.1" placeholder="0.0" required max="4" min="0" title="0 ~ 4"
                                                                       class="form-control" id="ds_sc_3" name="ds_sc_3" size="2" value="{{row[5]}}">+
                                                                <input type="number" step="0.1" placeholder="0.0" required max="4" min="0" title="0 ~ 4"
                                                                       class="form-control" id="ds_sc_4" name="ds_sc_4" size="2" value="{{row[6]}}">+
                                                                <input type="number" step="0.1" placeholder="-0.0" required max="0" min="-2" title="-2 ~ 0"
                                                                       class="form-control" id="ds_sc_5" name="ds_sc_5" size="2" value="{{row[7]}}">
                                                                <button type="button" class="btn btn-default btn-sm" onclick="checkTotal('ds_sc', 'ds_sc_total')">=</button>
                                                                <button type="button" class="btn btn-warning btn-sm" id="ds_sc_total">{{row[2]}}</button>
                                                            </div>
                                                            <button class="btn btn-info btn-sm pull-right" type="submit" value="update">Update</button>
                                                        {% else %}
                                                            <strong>
                                                                <a href="/fm_validate?sm_plan_id={{sm_plan_id}}&fm_plan_id={{fm_plan_id}}&plan_sub_status={{plan_sub_status}}&dss={{row[0]}}">
                                                                    {{row[2]}}
                                                                </a> =
                                                            </strong>
                                                            {{row[3]}} + {{row[4]}} + {{row[5]}} + {{row[6]}}
                                                            {% if row[7] >= 0 %}
                                                                + {{row[7]}}
                                                            {% else %}
                                                                - {{0-row[7]}}
                                                            {% endif %}
                                                            <BR><BR>
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </td>
                                <td> <!-- stage 3:Reviewer Scores table -->
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>Scores</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for row in sm_current_pair_scores[2][2][2][3] %}
                                                <tr>
                                                    <td>
                                                        {% if row[0] == current_dstage_score_id %}
                                                            <input type="hidden" name="ds_sc_id" value="{{current_dstage_score_id}}">
                                                            <div class="form-group" id="ds_sc">
                                                                <input type="number" step="0.1" placeholder="0.0" required max="1" min="0" title="0 ~ 1" readonly
                                                                       class="form-control" id="ds_sc_1" name="ds_sc_1" size="1" value="{{row[3]}}">+
                                                                <input type="number" step="0.1" placeholder="0.0" required max="2" min="0" title="0 ~ 2"
                                                                       class="form-control" id="ds_sc_2" name="ds_sc_2" size="1" value="{{row[4]}}">+
                                                                <input type="number" step="0.1" placeholder="0.0" required max="3" min="0" title="0 ~ 3"
                                                                       class="form-control" id="ds_sc_3" name="ds_sc_3" size="1" value="{{row[5]}}">+
                                                                <input type="number" step="0.1" placeholder="0.0" required max="3" min="0" title="0 ~ 3"
                                                                       class="form-control" id="ds_sc_4" name="ds_sc_4" size="1" value="{{row[6]}}">
                                                                <input type="number" step="0.1" placeholder="0.0" required max="2" min="0" title="0 ~ 2"
                                                                       class="form-control" id="ds_sc_5" name="ds_sc_5" size="1" value="{{row[7]}}">
                                                                <input type="number" step="0.1" placeholder="0.0" required max="1" min="-1" title="-1 ~ 1"
                                                                       class="form-control" id="ds_sc_6" name="ds_sc_6" size="2" value="{{row[8]}}">
                                                                <input type="number" step="0.1" placeholder="0.0" required max="0" min="-2" title="-2 ~ 0"
                                                                       class="form-control" id="ds_sc_7" name="ds_sc_7" size="2" value="{{row[9]}}">
                                                                <button type="button" class="btn btn-default btn-sm" onclick="checkTotal('ds_sc', 'ds_sc_total')">=</button>
                                                                <button type="button" class="btn btn-warning btn-sm" id="ds_sc_total">{{row[2]}}</button>
                                                            </div>
                                                            <button class="btn btn-info btn-sm pull-right" type="submit" value="update">Update</button>
                                                        {% else %}
                                                            <strong>
                                                                <a href="/fm_validate?sm_plan_id={{sm_plan_id}}&fm_plan_id={{fm_plan_id}}&plan_sub_status={{plan_sub_status}}&dss={{row[0]}}">
                                                                    {{row[2]}}
                                                                </a> =
                                                            </strong>
                                                            {{row[3]}} + {{row[4]}} + {{row[5]}} + {{row[6]}} + {{row[7]}}
                                                            {% if row[8] >= 0 %}
                                                                + {{row[8]}}
                                                            {% else %}
                                                                - {{0-row[8]}}
                                                            {% endif %}
                                                            {% if row[9] >= 0 %}
                                                                + {{row[9]}}
                                                            {% else %}
                                                                - {{0-row[9]}}
                                                            {% endif %}
                                                            <BR><BR>
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- points calculation -->
            <div class="row">
                <div class="col-lg-4"> <!-- stage 1: Points table -->
                    <table class="table table-striped">
                        <tbody>
                            <tr style="text-align: left">
                                <td>Average</td>
                                <td style="text-align: left"> <!-- stage 1: reporter Average Point (AP) -->
                                    {{sm_current_pair_scores[0][2][0][5]}}
                                    <input type="hidden" name="1_rep_dstage_team_id" value="{{sm_current_pair_scores[0][2][0][2][1]}}">
                                    <input type="hidden" name="1_rep_dstage_team_AP" value="{{sm_current_pair_scores[0][2][0][5]}}">
                                </td>
                                <td style="text-align: left"> <!-- stage 1: opponent Average Point (AP) -->
                                    {{sm_current_pair_scores[0][2][1][5]}}
                                    <input type="hidden" name="1_opp_dstage_team_id" value="{{sm_current_pair_scores[0][2][1][2][1]}}">
                                    <input type="hidden" name="1_opp_dstage_team_AP" value="{{sm_current_pair_scores[0][2][1][5]}}">
                                </td>
                                <td style="text-align: left"> <!-- stage 1: reviewer Average Point (AP) -->
                                    {{sm_current_pair_scores[0][2][2][5]}}
                                    <input type="hidden" name="1_rev_dstage_team_id" value="{{sm_current_pair_scores[0][2][2][2][1]}}">
                                    <input type="hidden" name="1_rev_dstage_team_AP" value="{{sm_current_pair_scores[0][2][2][5]}}">
                                </td>
                            </tr>
                            <tr> <!-- stage 1: Factor -->
                                <td>Factor</td>
                                <td style="text-align: left"> <!-- stage 1: reporter Factor -->
                                    {{sm_current_pair_scores[0][2][0][2][4]}}
                                    {% if sm_current_pair_scores[0][2][0][7] > 0 %}
                                     - {{sm_current_pair_scores[0][2][0][7]}}
                                    {% endif %}
                                    {% if sm_current_pair_scores[0][2][0][2][6] > 0 %}
                                        (*G1)
                                    {% endif %}
                                    {% if sm_current_pair_scores[0][2][0][2][7] > 0 %}
                                        (*G2)
                                    {% endif %}
                                </td>
                                <td style="text-align: left">{{sm_current_pair_scores[0][2][0][2][5]}}</td>
                                <td style="text-align: left">{{sm_current_pair_scores[0][2][0][2][9]}}</td>
                            </tr>
                            <tr> <!-- stage 1: Points -->
                                <td>Points</td>
                                <td style="text-align: left"> <!-- stage 1: reporter Point -->
                                    {{sm_current_pair_scores[0][2][0][6]}}
                                    <input type="hidden" name="1_rep_dstage_team_P" value="{{sm_current_pair_scores[0][2][0][6]}}">
                                </td>
                                <td style="text-align: left"> <!-- stage 1: opponent Point -->
                                    {{sm_current_pair_scores[0][2][1][6]}}
                                    <input type="hidden" name="1_opp_dstage_team_P" value="{{sm_current_pair_scores[0][2][1][6]}}">
                                </td>
                                <td style="text-align: left"> <!-- stage 1: reviewer Point -->
                                    {{sm_current_pair_scores[0][2][2][6]}}
                                    <input type="hidden" name="1_rev_dstage_team_P" value="{{sm_current_pair_scores[0][2][2][6]}}">
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                 <!-- stage 2: Points table -->
                <div class="col-lg-4">
                    <table class="table table-striped">
                        <tbody>
                            <tr style="text-align: left">  <!-- stage 2: Average -->
                                <td style="text-align: left">
                                    {{sm_current_pair_scores[1][2][0][5]}}
                                    <input type="hidden" name="2_rep_dstage_team_id" value="{{sm_current_pair_scores[1][2][0][2][1]}}">
                                    <input type="hidden" name="2_rep_dstage_team_AP" value="{{sm_current_pair_scores[1][2][0][5]}}">
                                </td>
                                <td style="text-align: left">
                                    {{sm_current_pair_scores[1][2][1][5]}}
                                    <input type="hidden" name="2_opp_dstage_team_id" value="{{sm_current_pair_scores[1][2][1][2][1]}}">
                                    <input type="hidden" name="2_opp_dstage_team_AP" value="{{sm_current_pair_scores[1][2][1][5]}}">
                                </td>
                                <td style="text-align: left">
                                    {{sm_current_pair_scores[1][2][2][5]}}
                                    <input type="hidden" name="2_rev_dstage_team_id" value="{{sm_current_pair_scores[1][2][2][2][1]}}">
                                    <input type="hidden" name="2_rev_dstage_team_AP" value="{{sm_current_pair_scores[1][2][2][5]}}">
                                </td>
                            </tr>
                            <tr> <!-- Factor -->
                                <td style="text-align: left">
                                    {{sm_current_pair_scores[1][2][0][2][4]}}
                                    {% if sm_current_pair_scores[1][2][0][7] > 0 %}
                                     - {{sm_current_pair_scores[1][2][0][7]}}
                                    {% endif %}
                                    {% if sm_current_pair_scores[1][2][0][2][6] > 0 %}
                                        (*G1)
                                    {% endif %}
                                    {% if sm_current_pair_scores[1][2][0][2][7] > 0 %}
                                        (*G2)
                                    {% endif %}
                                </td>
                                <td style="text-align: left">{{sm_current_pair_scores[1][2][0][2][5]}}</td>
                                <td style="text-align: left">{{sm_current_pair_scores[1][2][0][2][9]}}</td>
                            </tr>
                            <tr> <!-- Points */ -->
                                <td style="text-align: left"> <!-- stage 2: Reporter Points -->
                                    {{sm_current_pair_scores[1][2][0][6]}}
                                    <input type="hidden" name="2_rep_dstage_team_P" value="{{sm_current_pair_scores[1][2][0][6]}}">
                                </td>
                                <td style="text-align: left">
                                    {{sm_current_pair_scores[1][2][1][6]}}
                                    <input type="hidden" name="2_opp_dstage_team_P" value="{{sm_current_pair_scores[1][2][1][6]}}">
                                </td>
                                <td style="text-align: left">
                                    {{sm_current_pair_scores[1][2][2][6]}}
                                    <input type="hidden" name="2_rev_dstage_team_P" value="{{sm_current_pair_scores[1][2][2][6]}}">
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                 <!-- stage 3: Points table -->
                <div class="col-lg-4">
                    <table class="table table-striped">
                        <tbody>
                            <tr style="text-align: left"> <!-- stage 3: Average -->
                                <td style="text-align: left"> <!-- stage 3: Reporter Average -->
                                    {{sm_current_pair_scores[2][2][0][5]}}
                                    <input type="hidden" name="3_rep_dstage_team_id" value="{{sm_current_pair_scores[2][2][0][2][1]}}">
                                    <input type="hidden" name="3_rep_dstage_team_AP" value="{{sm_current_pair_scores[2][2][0][5]}}">
                                </td>
                                <td style="text-align: left"> <!-- stage 3: Opponent Average -->
                                    {{sm_current_pair_scores[2][2][1][5]}}
                                    <input type="hidden" name="3_opp_dstage_team_id" value="{{sm_current_pair_scores[2][2][1][2][1]}}">
                                    <input type="hidden" name="3_opp_dstage_team_AP" value="{{sm_current_pair_scores[2][2][1][5]}}">
                                </td>
                                <td style="text-align: left"> <!-- stage 3: Reviewer Average -->
                                    {{sm_current_pair_scores[2][2][2][5]}}
                                    <input type="hidden" name="3_rev_dstage_team_id" value="{{sm_current_pair_scores[2][2][2][2][1]}}">
                                    <input type="hidden" name="3_rev_dstage_team_AP" value="{{sm_current_pair_scores[2][2][2][5]}}">
                                </td>
                            </tr>
                            <tr> <!-- stage 3: Factors -->
                                <td style="text-align: left"> <!-- stage 3: Reviewer Factor -->
                                    {{sm_current_pair_scores[2][2][0][2][4]}}
                                    {% if sm_current_pair_scores[2][2][0][7] > 0 %}
                                     - {{sm_current_pair_scores[2][2][0][7]}}
                                    {% endif %}
                                    {% if sm_current_pair_scores[2][2][0][2][6] > 0 %}
                                        (*G1)
                                    {% endif %}
                                    {% if sm_current_pair_scores[2][2][0][2][7] > 0 %}
                                        (*G2)
                                    {% endif %}
                                </td>
                                <td style="text-align: left">{{sm_current_pair_scores[2][2][0][2][5]}}</td>
                                <td style="text-align: left">{{sm_current_pair_scores[2][2][0][2][9]}}</td>
                            </tr>
                            <tr> <!-- stage 3: Points -->
                                <td style="text-align: left"> <!-- stage 3: Reporter Points -->
                                    {{sm_current_pair_scores[2][2][0][6]}}
                                    <input type="hidden" name="3_rep_dstage_team_P" value="{{sm_current_pair_scores[2][2][0][6]}}">
                                </td>
                                <td style="text-align: left"> <!-- stage 3: Opponent Points -->
                                    {{sm_current_pair_scores[2][2][1][6]}}
                                    <input type="hidden" name="3_opp_dstage_team_P" value="{{sm_current_pair_scores[2][2][1][6]}}">
                                </td>
                                <td style="text-align: left"> <!-- stage 3: Reviewer Points -->
                                    {{sm_current_pair_scores[2][2][2][6]}}
                                    <input type="hidden" name="3_rev_dstage_team_P" value="{{sm_current_pair_scores[2][2][2][6]}}">
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <hr><button type="submit" class="btn btn-info pull-right" name="validate" value="correct" onclick="return confirm('Please double check your data, it can not be re-do! DO NOT use the back button in the browser! Are you sure?')">I confirm the scoresheet is correct.</button>
    </form>
    <script>
    function checkTotal(scoreItemsDivId, scoreTotalDivId) {
        var x = document.getElementsByTagName("input");
        var y = 0.0;
        for(var i = 0; i < x.length; i++)
        {
            if(x[i].parentNode == document.getElementById(scoreItemsDivId))
            {
               y = y + parseFloat(x[i].value);
            }
        }

        document.getElementById(scoreTotalDivId).innerHTML = y;
    }
    </script>
{% endblock %}